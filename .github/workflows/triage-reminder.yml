name: Triage reminder
on:
  schedule:
    # run daily at 08:00 UTC
    - cron: '0 8 * * *'
  workflow_dispatch:
jobs:
  remind:
    runs-on: ubuntu-latest
    steps:
      - name: Post friendly reminders for old triage issues
        uses: actions/github-script@v6
        with:
          script: |
            const DAYS = 7; // change this number if you want a different delay
            // cutoff date formatted as YYYY-MM-DD
            const cutoff = new Date(Date.now() - DAYS * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            const q = `repo:${context.repo.owner}/${context.repo.repo} is:issue is:open label:triage created:<${cutoff}`;
            const res = await github.rest.search.issuesAndPullRequests({ q, per_page: 100 });
            if (!res.data.items || res.data.items.length === 0) {
              console.log('No triage issues older than', DAYS, 'days.');
              return;
            }
            for (const item of res.data.items) {
              const number = item.number;
              // plain friendly reminder message
              const body = "Hi â€” this issue has been waiting for a first review for a while. If you can, please add any helpful details (steps, screenshots), or maintainers will triage it soon. Thanks!";
              // avoid duplicate reminder comments
              const comments = await github.rest.issues.listComments({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: number,
                per_page: 100
              });
              const already = comments.data.some(c => c.body && c.body.includes('this issue has been waiting for a first review'));
              if (!already) {
                await github.rest.issues.createComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: number,
                  body
                });
              }
            }
